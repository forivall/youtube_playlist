(function(){if(typeof console==="undefined"){console={log:function(){}}}var getScript=function(url,success){var script=document.createElement("script");script.src=url;var head=document.getElementsByTagName("head")[0];var done=false;script.onload=script.onreadystatechange=function(){var ready=!this.readyState||this.readyState=="loaded"||this.readyState=="complete";if(!done&&ready){done=true;success();script.onload=script.onreadystatechange=null;head.removeChild(script)}};head.appendChild(script)};getScript("//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js",function(){var jq14=jQuery.noConflict(true);(function($){$.getScript("https://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js",function(){var ids=[];$('a[href^="http://www.youtube"]').each(function(){var id=this.href.replace(/^.*v=/,"").replace(/\&.*$/,"");if($.inArray(id,ids)<0){ids.push(id)}});console.log("video ids",ids);var index=0;var index_inc=function(){index++;if(index>=ids.length){index-=ids.length}};var index_dec=function(){index--;if(index<0){index+=ids.length}};var cancel=function(){$("#shadow, #player_box").remove();$(document).unbind("keyup.player")};$(document).bind("keyup.player",function(e){if(e.keyCode==27){cancel()}});var player=null;var player_id="playlist_player";var play_current=function(){console.log("Playing: ",index,ids[index]);player.loadVideoById(ids[index])};var $shadow=$("<div />",{id:"shadow",css:{"background-color":"black",position:"fixed",left:0,top:0,width:"100%",height:"100%","z-index":1e3},click:cancel});var $player_box=$("<div />",{id:"player_box",css:{position:"fixed",left:"50%",top:"50%",width:320,height:240,"margin-left":-160,"margin-top":-120,"z-index":1001}});var $player=$("<div />",{id:player_id});var $prev_button=$("<a />",{href:"javascript:;",text:"previous",css:{"float":"left"},click:function(){index_dec();play_current()}});var $next_button=$("<a />",{href:"javascript:;",text:"next",css:{"float":"right"},click:function(){index_inc();play_current()}});$player_box.append($player).append($prev_button).append($next_button);$("body").append($shadow).append($player_box);$shadow.css("opacity",.8);var params={allowScriptAccess:"always"};var url="http://www.youtube.com/apiplayer?enablejsapi=1&version=3&playerapiid="+player_id;swfobject.embedSWF(url,player_id,"320","240","9.0.0",null,null,params,{id:player_id});window.onYouTubePlayerReady=function(player_id){player=document.getElementById(player_id);player.addEventListener("onStateChange","playerStateChanged");player.addEventListener("onError","playerOnError");play_current()};window.playerOnError=function(code){console.log("error",code);ids.splice(index,1);if(index>=ids.length){index=0}play_current()};window.playerStateChanged=function(state){if(state==0){index_inc();play_current()}}})})(jq14)})})();